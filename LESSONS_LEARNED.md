# UI 컴포넌트 작업 실패 기록

이 문서는 semester-schedule-generator 개발 과정에서 실패했던 UI 구현 시도를 정리한 것이다. 같은 실수를 반복하지 않기 위해 기록한다.

---

## 1. 날짜 입력 (type="date" → type="text" 변경 시도)

### 시도 1: `useDateInput` 훅 + `type="date"` + `onKeyDown` 버퍼
- **의도**: `type="date"` 위에서 키보드 입력을 가로채서 자동 포맷팅
- **결과**: 실패
- **원인**: 브라우저 `type="date"` 입력은 내부적으로 연/월/일 서브필드를 가지고 있어서 `onKeyDown` 이벤트가 전체 필드가 아닌 서브필드에서 발생한다. 버퍼 방식으로 제어가 불가능하다.

### 시도 2: `type="text"` + `inputMode="numeric"` + 자동 포맷팅
- **의도**: 텍스트 필드에서 숫자만 입력받아 `YYYY-MM-DD`로 자동 변환
- **결과**: 실패
- **원인**: 캘린더 피커가 완전히 사라진다. 사용자가 달력으로 날짜를 선택하는 것이 불가능해지고, 텍스트 입력만으로 날짜를 넣어야 하는데 형식 검증/제어 장치도 부족했다.
- **사용자 피드백**: "캘린더 입력기가 사라짐", "형식을 제어할 장치가 전혀 없음"

### 시도 3: DateInput 컴포넌트 (`type="date"` + `type="text"` 나란히 배치)
- **의도**: 캘린더 피커와 텍스트 직접 입력을 둘 다 제공
- **결과**: 기능은 작동했으나, 전체 코드 복잡도가 급상승하여 다른 기능(컬럼 추가 등)이 깨지는 부작용 발생. 사용자 요청으로 롤백됨.

### 교훈
- **`type="date"`를 건드리지 마라.** 브라우저 네이티브 date picker는 내부 구조가 복잡해서 커스텀 키보드 핸들링이 사실상 불가능하다.
- 날짜 입력 UX를 개선하려면 `react-datepicker` 같은 전용 라이브러리를 사용하거나, 네이티브 `type="date"`를 그대로 두는 게 안전하다.
- 두 개의 입력 필드를 나란히 놓는 것은 복잡도 대비 이점이 적다.

---

## 2. 드래그 앤 드롭 컬럼 순서 변경

### 시도 1: `draggable` + `onDragStart`/`onDragOver`/`onDragEnd` (onDrop 누락)
- **의도**: 출력 컬럼 리스트와 데이터 테이블 헤더에 네이티브 드래그 앤 드롭 적용
- **결과**: 실패
- **원인**:
  - `onDrop` 핸들러를 빠뜨렸다. 드래그는 시작되지만 드롭 시 아무 일도 일어나지 않음.
  - 드래그 핸들을 `<button>`으로 만들고 `onMouseDown={(e) => e.stopPropagation()}`을 넣었는데, 이것이 오히려 드래그 시작 이벤트 자체를 차단했다.
- **사용자 피드백**: "모양만 있을 뿐 실제로 드래그해서 위치를 바꿀 수 없음"

### 시도 2: `onDrop` 추가 + `<span>` 핸들 + `useRef` 인덱스 추적
- **의도**: 누락된 핸들러를 보완하고 핸들 요소를 교체
- **결과**: 테스트 전에 사용자가 롤백을 요청하여 미검증.

### 교훈
- **네이티브 HTML 드래그 앤 드롭의 필수 4요소**: `onDragStart`, `onDragOver` (`e.preventDefault()` 필수), `onDrop`, `draggable={true}`. 하나라도 빠지면 작동하지 않는다.
- `<button>` 등의 인터랙티브 요소를 드래그 핸들로 쓰면 이벤트 충돌이 발생한다. `<span>` 또는 `<div>`를 사용하라.
- 드래그 앤 드롭이 필요하면 `@dnd-kit/core` 같은 라이브러리 사용을 먼저 고려하라. 네이티브 DnD는 엣지케이스가 많다.

---

## 3. CSV 숫자-하이픈 엑셀 변환 방지

### 시도 1: `="1-7"` 수식 래핑
- **의도**: CSV에서 `="값"` 형태로 감싸면 엑셀이 텍스트로 인식할 것으로 기대
- **결과**: 실패
- **원인**: 엑셀 버전에 따라 `="1-7"` 수식이 제대로 작동하지 않는 경우가 있다. 사용자의 엑셀에서는 여전히 `01-07` (날짜)로 표시됨.
- **사용자 피드백**: "학급에 숫자 보호 체크했음에도 불구하고 엑셀 다운받았더니 01-07 이따구로 나온다"

### 시도 2: 탭 접두사 (`\t`)
- **의도**: 값 앞에 탭 문자를 넣으면 엑셀이 텍스트로 인식
- **결과**: 사용자 요청으로 롤백되어 미검증.

### 최종 해결: 작은따옴표(`'`) 접두사
- `'1-7` 형태로 저장. 엑셀에서 CSV를 열 때 `'`가 텍스트 강제 접두사로 인식되어 날짜 변환이 방지됨.
- 정규식 `^\d+(-\d+)+$`로 숫자-하이픈 패턴 자동 감지.

### 교훈
- 엑셀의 CSV 파싱은 버전마다 다르게 동작한다. `="값"` 수식 방식은 신뢰할 수 없다.
- 작은따옴표 접두사가 가장 범용적인 해결책이다.
- 이런 종류의 변경은 반드시 실제 엑셀에서 테스트한 후 적용해야 한다.

---

## 4. 복합 변경의 부작용

### 문제
날짜 입력, 드래그 앤 드롭, CSV 보호, 컬럼 추가 로직을 한 번에 리팩터링하면서 **기존에 작동하던 컬럼 추가 버튼이 깨졌다.**

### 원인
- `DraggableColumnList`, `DateInput` 등 새 컴포넌트를 추가하면서 상태 관리 로직이 복잡해짐
- 클로저가 stale state를 참조하게 되어 `setColumns`/`setEntries` 호출이 의도대로 작동하지 않음

### 교훈
- **한 번에 하나만 바꿔라.** 여러 기능을 동시에 수정하면 어디서 문제가 생겼는지 추적이 어렵다.
- 상태 setter에서는 항상 `prev =>` 콜백 패턴을 사용하라. 직접 state 참조는 stale closure에 취약하다.
- 새 컴포넌트를 추가할 때 기존 핸들러가 정상 작동하는지 반드시 확인하라.

---

## 5. .next 캐시 충돌

### 문제
dev 서버(`npm run dev`)가 실행 중인 상태에서 `npm run build`를 실행하면 `.next` 폴더가 충돌하여 "Internal Server Error"가 발생한다.

### 발생 빈도
이 프로젝트에서만 3회 발생.

### 해결
```powershell
# restart.ps1
Get-Process -Name node -ErrorAction SilentlyContinue | Stop-Process -Force
Start-Sleep -Seconds 2
Remove-Item -Recurse -Force '.next' -ErrorAction SilentlyContinue
npm run dev
```

### 교훈
- **dev 서버 실행 중에 `npm run build`를 절대 하지 마라.**
- 타입 체크는 `npx tsc --noEmit`으로 하면 `.next`에 영향 없이 검증 가능하다.
- "Internal Server Error"가 나면 `.next` 삭제부터 시도하라.

---

## 6. PowerShell + Bash 도구 조합 문제

### 문제
Bash 도구에서 `powershell -Command "..."` 실행 시 `$` 문자가 Bash에 의해 변수로 해석된다.

### 예시
```bash
# 의도: PowerShell의 $_.StartTime
powershell -Command "Get-Process | Select $_.StartTime"
# 실제: Bash가 $_ 를 빈 문자열로 치환 → 에러
```

### 해결
복잡한 PowerShell 로직은 `.ps1` 파일로 작성 후 `-File` 옵션으로 실행한다.
```bash
powershell -ExecutionPolicy Bypass -File script.ps1
```

### 교훈
- PowerShell 명령에 `$` 변수가 포함되면 반드시 스크립트 파일로 분리하라.
- 또는 Node.js 스크립트(`.mjs`)로 대체하라.
